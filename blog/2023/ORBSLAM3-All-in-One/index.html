<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ORBSLAM3 All in One | Ren-Wu Li</title>
    <meta name="author" content="Ren-Wu  Li">
    <meta name="description" content="Dive into ORBSLAM3">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/logo.ico">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://renwuli.github.io/blog/2023/ORBSLAM3-All-in-One/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/">Ren-Wu Li</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/repositories/">Repositories</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">ORBSLAM3 All in One</h1>
    <p class="post-meta">April 10, 2023</p>
    <p class="post-tags">
      <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>
        ·  
        <a href="/blog/tag/orbslam3">
          <i class="fas fa-hashtag fa-sm"></i> ORBSLAM3</a>  
          
        ·  
        <a href="/blog/category/slam">
          <i class="fas fa-tag fa-sm"></i> SLAM</a>  
          

    </p>
  </header>

  <article class="post-content">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2">
<a href="#%E7%AE%97%E6%B3%95%E6%80%BB%E8%A7%88">算法总览</a>
<ul>
<li class="toc-entry toc-h3"><a href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E6%94%AF%E6%8C%81">传感器支持</a></li>
<li class="toc-entry toc-h3"><a href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84">系统架构</a></li>
</ul>
</li>
<li class="toc-entry toc-h2">
<a href="#%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3">算法详解</a>
<ul>
<li class="toc-entry toc-h3"><a href="#%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5">名词概念</a></li>
<li class="toc-entry toc-h3"><a href="#%E8%B7%9F%E8%B8%AA">跟踪</a></li>
</ul>
</li>
</ul>
<p>写这篇文章的初衷有两个，一是目前的简中互联网实在是没有对ORBSLAM3庖丁解牛解析很全面的博客，尽管有很多从理论和代码层面都分析的不错的文章和视频，还有开源的带注释的源码，但都不够系统，且有些资源是收费的；二是想要消化一下对ORBSLAM3，加深对此算法的理解，做到知其然并知其所以然。我希望能够通过我这篇长文，能够让希望了解ORBSLAM3算法的朋友不用再费心费力去找别的资料，一文就能搞懂理论和代码，所以我给这篇文章起了个题目：<em>ORBSLAM3 All in One</em>。</p>

<p>不同于其他文章可能会上来就讲前端，诸如ORB特征点是什么啊，为什么ORB特征具有旋转不变性啊，怎么用八叉树均匀地将特征点铺满整张图上啊，我觉得这些问题都非常细，一上来就看这些容易让人陷入局部极小值跳不出来，无法从宏观的角度去俯瞰整个世界，导致对ORBSLAM3失去兴趣。我将会以 <em>算法总览</em> – <em>算法详解</em> – <em>问题</em> 的思路，去介绍ORBSLAM3。</p>

<h2 id="算法总览">
<a class="anchor" href="#%E7%AE%97%E6%B3%95%E6%80%BB%E8%A7%88" aria-hidden="true"><span class="octicon octicon-link"></span></a>算法总览</h2>

<p>看到这篇文章的朋友应该都已经将ORBSLAM3的文章读过了，如果还没有读过的话，最好先赶紧去读一遍再说：<a href="https://arxiv.org/pdf/2007.11898.pdf" rel="external nofollow noopener" target="_blank">https://arxiv.org/pdf/2007.11898.pdf</a></p>

<h3 id="传感器支持">
<a class="anchor" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E6%94%AF%E6%8C%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>传感器支持</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">相机模型</th>
      <th style="text-align: center">相机组合</th>
      <th style="text-align: center">运行模式</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">针孔相机<br>鱼眼相机</td>
      <td style="text-align: center">单目<br>双目<br>RGB-D</td>
      <td style="text-align: center">视觉（Visual SLAM）<br>视觉-惯性（Visual-Inertial SLAM）</td>
    </tr>
  </tbody>
</table>

<p>从上表中可以看到 ORBSLAM3支持的传感器和运行模式那是相当丰富。当然，如果本文将以上的运行模式全都介绍一遍那是相当的冗余和啰嗦，所以本文以 <em>单目-针孔相机-视觉惯性</em> 模式为例展开介绍。其他的传感器组合和运行模式读者可以参考理解，触类旁通。</p>

<h3 id="系统架构">
<a class="anchor" href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84" aria-hidden="true"><span class="octicon octicon-link"></span></a>系统架构</h3>

<p>下图是算法整体的一个pipeline，可以看到一共分为了四个部分：</p>

<ul>
  <li>Tracking: 也就是跟踪，其输入是 <strong>图像帧</strong> 和 <strong>IMU帧</strong>，目的是得到当前帧相对于上一（关键）帧的相对位姿，如果我们知道了第一个（关键）帧的位姿，那么从前往后我们便可以一帧一帧串起来，得到当前帧在世界坐标系中的绝对位姿。</li>
  <li>Local Mapping: 得到当前帧相对于上一帧（参考帧）的相对位姿之后我们便可以通过三角化计算出当前帧视觉特征点的位置，如果当前帧检测出来了1000个特征点，那么局部地（从当前帧往前追溯一直到没有断掉为止），我们便得到了一张具有1000个特征点的地图。</li>
  <li>Loop &amp; Map Merging：即回环检测和地图合并。Local Mapping 毕竟是一个局部地图，如果我们在 Tracking 的时候突然丢失了怎么办？ORBSLAM3的做法是再建立一个局部的地图。而这些局部地图的合集，我们称作 Atlas，翻译为中文就是“地图册”。当运行一段时间之后，如果我们发现又回到了之前到过的地方（回环检测），便可以将之前的局部地图和目前的局部地图进行合并，得到一张更大、特征点更多的地图。</li>
  <li>Full BA：最后便是将位姿和特征点坐标进行联合优化，期待能够得到更加准确的位姿估计和更加准确的特征点地图。</li>
</ul>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig1-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig1-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig1-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/posts/orbslam3-all-in-one/fig1.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Figure 1
</div>

<h2 id="算法详解">
<a class="anchor" href="#%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3" aria-hidden="true"><span class="octicon octicon-link"></span></a>算法详解</h2>

<h3 id="名词概念">
<a class="anchor" href="#%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5" aria-hidden="true"><span class="octicon octicon-link"></span></a>名词概念</h3>

<ul>
  <li>帧 (Frame)</li>
</ul>

<p>帧 (Frame) 可以简单地理解为采集到视频流的每一帧图像。</p>

<ul>
  <li>关键帧 (Key Farme)</li>
</ul>

<p>关键帧 (Key Frame) 是帧 (Frame) 的一个子集，一般情况下是真子集。使用基于关键帧的视觉 SLAM 方法会仅使用一小部分图像帧来估计地图，丢弃掉冗余的信息，降低系统的复杂度。具体来说，当系统检测到场景中出现了显著的运动时，就会将当前图像帧作为一个新的关键帧，并用它来更新地图和计算相机的位姿。</p>

<p>关键帧的作用主要有以下几个方面：</p>

<ol>
  <li>
    <p>建图：通过对不同关键帧的匹配，可以在三维空间中重建场景，从而得到一个稠密的点云地图。</p>
  </li>
  <li>
    <p>定位：当相机在新的位置进行拍摄时，系统可以通过匹配当前帧与已有的关键帧，来估计相机的位姿和当前位置。</p>
  </li>
  <li>
    <p>优化：关键帧可以用于优化相机位姿和地图，从而提高系统的精度和稳定性。</p>
  </li>
</ol>

<p>总之，关键帧是视觉SLAM系统中的重要组成部分，它能够为后续的建图和定位提供重要的信息，从而实现更加准确和可靠的定位和建图。</p>

<ul>
  <li>地图点 (Map Point) 与 地图 (Map)</li>
</ul>

<p>地图点 (Map Point) 是指在三维空间中被重建出来的具有代表性的特征点，并且通过特征匹配算法来识别和跟踪这些特征点，它们对应于场景中的真实物体或者场景结构的点。而地图 (Map) 则是由这些地图点构成的三维点云地图，它记录了场景中物体的位置和姿态信息。地图点和地图之间的关系是非常密切的，地图点是构成地图的基本元素，地图则是地图点的集合。在建立地图的过程中，ORB-SLAM3算法通过将每个图像帧与前面的关键帧匹配，然后通过三角化算法将匹配到的ORB特征点转化为地图点，从而逐渐构建出三维地图。地图点的数量和分布对地图的质量和精度有着重要的影响。</p>

<ul>
  <li>地图册 (Atlas)</li>
</ul>

<p>地图册 (Atlas) 内包含了多个地图，系统内会始终存在一个活跃的地图和一些不活跃的地图，地图之间是不连通的，而每个地图描述了一个联通的局部区域，并包含了该区域的关键帧、地图点以及它们之间的约束信息。跟踪线程不断估计到来的关键帧位姿，并将关键帧插入到当前活跃的地图，并持续优化关键帧的位姿，局部建图线程会持续扩充当前活跃地图。系统还构建了一个唯一的 DBoW2 关键帧数据库，用于重定位、回环检测和地图合并。</p>

<p>Atlas的主要作用是管理和优化大规模地图，因为ORB-SLAM3可以将地图分解为多个局部地图，并在这些局部地图之间建立约束关系，从而实现了地图的高效管理和优化。在定位时，ORB-SLAM3可以利用Atlas中的约束信息来提高定位的精度和鲁棒性。</p>

<ul>
  <li>共视图 (Covisibility Graph)</li>
</ul>

<p>共视图 (Covisibility Graph) 表达了关键帧之间的关系。共视图中的节点为关键帧，如果两个节点（关键帧）之间有足够的共视关系，即他们能够同时观测到一些相同的地图点，则这两个节点之间存在一条边，边的权重为两个关键帧中共同观测到的地图点数量。在局部地图优化中，ORB-SLAM3 选择与当前关键帧具有很强共视关系的关键帧进行优化；在回环检测中，也会利用与当前关键帧具有很强共视关系的关键帧来确定是否存在回环。</p>

<ul>
  <li>生成树 (Spanning Tree)</li>
</ul>

<p>在图论中，一个连通图的生成树是该图的一个极小连通子图，它包含图中所有的 n 个节点，但只构成一棵树的 n-1 条边。ORB-SLAM3 中的生成树 (Spanning Tree) 便是共视图的一个生成树。生成树的目的是将共视图中所有的关键帧连接成一颗树，以减少地图优化和回环检测的计算复杂度。由于共视图中的所有关键帧之间都有一定程度的视觉重叠，因此直接使用共视图进行地图优化和回环检测会导致大量冗余计算。而生成树则可以使计算集中在树形结构中，避免冗余计算。</p>

<ul>
  <li>本质图 (Essential Graph)</li>
</ul>

<p>本质图 (Essential Graph) 的概念在 ORB-SLAM3 中被一笔带过，我们可以通过最初版本的 ORB-SLAM 中找到相关的介绍：</p>

<blockquote>
  <p>In order to correct a loop we perform a pose graph optimization that distributes the loop closing error along the graph. In order not to include all the edges provided by the covisibility graph, which can be very dense, we propose to build an Essential Graph that retains all the nodes (keyframes), but less edges, still preserving a strong network that yields accurate results. The system builds incrementally a spanning tree from the initial keyframe, which provides a connected subgraph of the covisibility graph with minimal number of edges. When a new keyframe is inserted, it is included in the tree linked to the keyframe which shares most point observations, and when a keyframe is erased by the culling policy, the system updates the links affected by that keyframe. The Essential Graph contains the spanning tree, the subset of edges from the covisibility graph with high covisibility (min = 100), and the loop closure edges, resulting in a strong network of cameras.</p>
</blockquote>

<p>也就是说，由于共视图的边太过稠密，给优化带来了不小的麻烦，而本质图的节点和共视图保持一致，但是拥有更少的边，并且在本质图上进行优化也能够提供足够精确的结果。新的关键帧会在生成树中被链接到与它拥有最多共视关系的关键帧上，而当该关键帧被删除时，也会在生成树中删掉与该关键帧的链接关系。本质图中的边保留了共视图中权重（共视关系）大于一定阈值的边，并在此基础上加入了回环边。</p>

<p>下图给出了关键帧、共视图、生成树和本质图之间的关系。可以看出，共视图最稠密，本质图次之，生成树最稀疏。</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig2-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig2-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/posts/orbslam3-all-in-one/fig2-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/posts/orbslam3-all-in-one/fig2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Figure 2
</div>

<h3 id="跟踪">
<a class="anchor" href="#%E8%B7%9F%E8%B8%AA" aria-hidden="true"><span class="octicon octicon-link"></span></a>跟踪</h3>

<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-hdrmjj --output /tmp/output20230717-2342-5bgcvu.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;


如上图所示跟踪线程大体上包括三个主要部分：
1. 初始化
2. 跟踪：跟踪又主要包括从上一（关键）帧到当前帧的位姿跟踪，和当前帧与局部地图之间的跟踪
3. 记录位姿信息：跟踪并优化得到当前帧的位姿之后，记录下来

上面流程图的重要模块的主要内容和流程分别如下所示：

- 初始化

<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-jqxuv --output /tmp/output20230717-2342-ww09t0.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;

- 恒速模型跟踪

<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-pp3swy --output /tmp/output20230717-2342-3ut2gf.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;

- 参考关键帧跟踪

<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-tcr49x --output /tmp/output20230717-2342-yun81o.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;

- 局部地图跟踪

<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-4o162l --output /tmp/output20230717-2342-e29n3h.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;

- 判断当前帧是否为关键帧


<center>
<div class="jekyll-diagrams diagrams mermaid">
  Rendering Failed: mmdc --puppeteerConfigFile /home/runner/work/renwuli.github.io/renwuli.github.io/vendor/bundle/ruby/3.2.0/gems/jekyll-diagrams-0.10.0/vendor/mermaid_puppeteer_config.json --configFile mermaid.json --input /tmp/input20230717-2342-4phky8 --output /tmp/output20230717-2342-5lszbt.svg: 
Error: Evaluation failed: Error: Diagrams beginning with --- are not valid. If you were trying to use a YAML front-matter, please ensure that you've correctly opened and closed the YAML front-matter with un-indented `---` blocks
    at Object.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:80:3262)
    at H0e.parser.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:299)
    at H0e.parse (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:539)
    at new H0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:421)
    at _4A (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:81:845)
    at Object.cat [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:88:585)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:538
    at new Promise (<anonymous>)
    at f (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:515)
    at p0e (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:190)
    at file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:674
    at new Promise (<anonymous>)
    at Object.R0e [as render] (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/dist/index.html:90:483)
    at pptr://__puppeteer_evaluation_script__:12:46
    at ExecutionContext._ExecutionContext_evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:254:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async ExecutionContext.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ExecutionContext.js:143:16)
    at async CDPJSHandle.evaluate (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/JSHandle.js:56:16)
    at async CDPElementHandle.$eval (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/node_modules/puppeteer-core/lib/esm/puppeteer/common/ElementHandle.js:86:24)
    at async renderMermaid (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:246:22)
    at async parseMMD (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:218:20)
    at async run (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:477:20)
    at async cli (file:///usr/local/lib/node_modules/@mermaid-js/mermaid-cli/src/index.js:184:3)



&lt;/div&gt;

&lt;/center&gt;

### 局部建图

- 插入新关键帧

- 地图点更新

- 局部 BA

- IMU 初始化

- 局部关键帧剔除

- IMU 尺度优化

### 回环检测与地图合并

- 回环检测
    - 数据库查询
    - 计算相对位姿
    - 本质图优化
    - 回环

- 地图合并
    - 本质图优化
    - BA
    - 合并地图

### 全局优化
</anonymous></anonymous>
</div>
</center></anonymous></anonymous>
</div>
</center></anonymous></anonymous>
</div>
</center></anonymous></anonymous>
</div>
</center></anonymous></anonymous>
</div>
</center></anonymous></anonymous>
</div>
</center>

  </article>


  
    
    <br>
    <hr>
    <br>
    <ul class="list-disc pl-8"></ul>

    <!-- Adds related posts to the end of an article -->
    <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
    <p class="mb-2">Here are some more articles you might like to read next:</p>
  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Wheel-Preintegration/">Wheel Preintegration</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/VINS-Wheel/">VINS-Wheel</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/IMU-Preintegration/">IMU Preintegration</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/SymmetryNet/">SymmetryNet</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/NeRD/">NeRD</a>
  </li>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2023 Ren-Wu  Li. All rights are reserved.
      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
